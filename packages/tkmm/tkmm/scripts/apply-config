#!/bin/sh

# TKMM Configuration Script
# This script sets the volume and display scale based on the config file

. /usr/bin/read-config

SCALE_SETTING=$(read_tkmm_config "Display" "scale" "2")
VOLUME_PERCENT=$(read_tkmm_config "Audio" "volume" "40")
SOUND_CARD_NAME=$(cat /storage/.cache/sound_card)

case $SCALE_SETTING in
    1) SCALE_FACTOR="0.75x0.75" ;;
    2) SCALE_FACTOR="0.875x0.875" ;;
    3) SCALE_FACTOR="1x1" ;;
    4) SCALE_FACTOR="1.25x1.25" ;;
    *) SCALE_FACTOR="0.875x0.875" ;;
esac

# scale the display for TKMM based on the config file because switch screen small
xrandr --output "$(xrandr | awk '/ connected / { print $1; exit }')" --scale $SCALE_FACTOR

# set the sound card to configured volume
amixer -c "$SOUND_CARD_NAME" set 'x Speaker' "${VOLUME_PERCENT}%" >/dev/null 2>&1
